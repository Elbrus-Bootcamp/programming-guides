# Bcrypt

**bcrypt** — это популярная и надежная библиотека для хеширования паролей, используемая
для безопасного хранения паролей в базах данных. Хеширование паролей с использованием
bcrypt защищает их от атак, таких как перебор паролей и атаки по радужным таблицам.

## Основные особенности bcrypt

1. **Адаптивная сложность (cost factor)**:

   - bcrypt использует параметр сложности (cost factor), который определяет количество
     итераций алгоритма. Чем выше значение этого параметра, тем больше времени требуется
     для хеширования пароля, что замедляет атаки перебора.

2. **Соль (Salt)**:

   - bcrypt автоматически генерирует уникальную "соль" для каждого хеша пароля, что делает
     каждый хеш уникальным даже для одинаковых паролей и защищает от атак по радужным
     таблицам.

3. **Хеширование и проверка**:
   - bcrypt предоставляет метод для хеширования паролей и проверки их хеша. При вводе
     пароля bcrypt снова хеширует его с той же солью и сравнивает результат с сохраненным
     хешем.

## Пример использования

В Node.js bcrypt можно использовать с помощью библиотеки `bcrypt` или `bcryptjs`.

### Установка

```bash
npm install bcrypt
```

### Пример использования

```js
const bcrypt = require('bcrypt');

const saltRounds = 10; // Уровень сложности
const plainPassword = 'mySecurePassword';

async function hashAndComparePassword() {
  try {
    // Генерация хеша пароля
    const hash = await bcrypt.hash(plainPassword, saltRounds);
    console.log('Хеш пароля:', hash);

    // Сравнение пароля и хеша
    const result = await bcrypt.compare(plainPassword, hash);
    console.log('Пароль верен:', result); // true
  } catch (err) {
    console.error('Ошибка:', err);
  }
}
```

### Cookies

Cookies — это небольшие текстовые файлы, которые веб-сайты сохраняют на вашем устройстве
(компьютере, смартфоне, планшете) через браузер. Эти файлы содержат данные, которые
позволяют сайтам «запоминать» вас, когда вы посещаете их снова.

### Express cookies

```js
//expressjs.com/en/api.html#res.cookie

//установить cookies
https: res.cookie('rememberme', '1', {
  expires: new Date(Date.now() + 900000),
  httpOnly: true,
});
//удалить cookie
res.cookie('name', 'tobi', { path: '/admin' });
res.clearCookie('name', { path: '/admin' });
```

### Cookie-parser

Это middleware для Node.js, которое используется в Express-приложениях для работы с
cookies (куки). Оно автоматически парсит (разбирает) заголовок Cookie в запросах,
преобразуя его в объект, доступный в req.cookies, что упрощает работу с куки в серверных
приложениях

```js
npm i cookie-parser //установка
const cookieParser = require('cookie-parser'); //подключение
app.use(cookieParser()); //применение
```

## JWT

**JWT (JSON Web Token)** — это стандарт для создания токенов, которые используются для
передачи информации между двумя сторонами в формате JSON. Эти токены обычно используются
для аутентификации и передачи информации между клиентом и сервером.

Состоит из

1. Header (Заголовок): Содержит информацию о типе токена (обычно это `JWT`) и алгоритме
   шифрования, который используется для создания подписи токена (например, `HS256` для
   HMAC SHA256).
2. **Payload (Полезная нагрузка)**: Содержит утверждения (claims), которые представляют
   собой информацию о пользователе и других данных. Эти утверждения могут быть
   стандартными (например, `iss` — издатель токена, `exp` — время истечения токена) или
   произвольными, добавленными по необходимости (например, `user_id`, `role`).
3. **Signature (Подпись)**: Подпись создается путем объединения закодированного заголовка
   и полезной нагрузки, а затем их шифрования с использованием секретного ключа или
   приватного ключа (в зависимости от алгоритма). Подпись необходима для проверки
   целостности токена и того, что он не был изменен.

### Установка и использование

```js
npm i jsonwebtoken //установка
const jwt = require('jsonwebtoken'); //подключение
const obj = {group:"raccoons", count: 18} //данные для payload JWT
const token = jwt.sign(obj, "secretPhrase", { expiresIn: '15m' }); //eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJncm91cCI6InJhY2Nvb25zIiwiY291bnQiOjE4LCJpYXQiOjE3MjM5OTg3MDAsImV4cCI6MTcyMzk5OTYwMH0.4-0P8-FgIn9IxU6qREuk9_Lpri2W_2rfk6DNxSzvzy4
```

Проверка токена:

```js
try {
  const decoded = jwt.verify(token, 'secretPhrase');
  console.log('Токен валиден:', decoded);
} catch (err) {
  console.error('Ошибка проверки токена:', err.message);
}
```
